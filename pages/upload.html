<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/js/all.min.js" integrity="sha512-rpLlll167T5LJHwp0waJCh3ZRf7pO6IT1+LZOhAyP6phAirwchClbTZV3iqL3BMrVxIYRbzGTpli4rfxsCK6Vw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <link rel="stylesheet" href="../public/code/styles/download.css"/>
    <link rel="stylesheet" href="../public/code/styles/upload.css"/>
    <link rel="stylesheet" href="/code/styles/download.css"/>
    <link rel="stylesheet" href="/code/styles/upload.css"/>
    <title>Document</title>
</head>

<body>
    <div class="mtio">
        <header>
            <nav class="nav">
            <input type="checkbox" id="check" />
            <label for="check" class="checkbtn">
                <i class="fas fa-bars"></i>
            </label>
            <label class="logo"> D.Star Server </label>
            <ul>
                <li><a href="#" class="active"> Home </a></li>
                <li><a href="/"> Upload </a></li>
                <li><a href="/pool"> Download </a></li>
                <li><a href="/getclipboard"> Copy </a></li>
                <li><a href="/pastclipboard"> Paste </a></li>
                <li><a target="_blank" href="https://github.com/Ddhruv-IOT/Smart-Share"> About </a></li>
            </ul>
            </nav>
        </header>

        <div class="cover">
            <div class="rmain">
                <div class="rholder">
                    <div class="rimg">
                        <img src="http://localhost/code/assets/dw.png"/>
                    </div>

                    <form>
                        <div class="file-area" id="file-area">
                            <label for="fileInput" class="label">
                                <input type="file" name="f" id="fileInput" class="fxx" multiple required>
                                <div class="rtxt">
                                    <p> Drag your files here<br/> OR</p>
                                </div>
                                <div class="rbtn-browse"> 
                                    <p> Browse </p> 
                                </div>
                            </label>
                        </div>
                        <div class="rbtn-submit" id="uploadButton"> Submit </div>
                    </form>
                    <p id="fileName">file Name</p>
                </div>
                <div class="rloder" id="rloder"></div>
            </div>
        </div>
    </div>

    <script>
        window.onload = ()=> {

            var fileArea = document.querySelector("#file-area");
            var fileInput = document.querySelector('#fileInput');
            var uploadButton = document.querySelector('#uploadButton');
            var meter = document.getElementById('rloder');
            var fileName = document.getElementById('fileName');
            meter.style.display = "none";
            fileName.innerText = "";

            fileArea.addEventListener('change', function() {
                 meter.style.display = "none"
                 var len = fileInput.files.length 
                 fileName.innerText = (len <= 1  ? `Selected: ${fileInput.files[0]['name']}` : `Selected: ${len} files`) 
            })

            uploadButton.addEventListener('click', function() {
                var formData = new FormData();
                var files = fileInput.files;

                if (files.length != 0) {
                    for (var i = 0; i < files.length; i++) {
                        formData.append("f", files[i]);
                    }

                    var xhr = new XMLHttpRequest();
                    xhr.open('POST', '/upload', true);

                    xhr.upload.onprogress = function(event) {
                        // Handle progress events
                        meter.style.display = "block"
                        var len = (event.loaded /event.total) * 90
                        meter.style.width = len + "%";
                        console.log((event.loaded /event.total) * 100)
                    };

                    xhr.onload = function(event) {
                        if(xhr.status == 200) {
                            // success Block
                            fileName.innerText = "Upload Successful!";
                            fileInput.value = '';
                        }
                        else {
                            fileName.innerText = "";
                            meter.style.display = "none"
                            alert("Failed")
                        }
                        console.log(xhr.status)
                    };
                    xhr.send(formData);
                } else {
                    alert("No files")
                    meter.style.display = "none";
                    fileName.innerText = "";
                }
            });
        }
    </script>
</body>
</html>
